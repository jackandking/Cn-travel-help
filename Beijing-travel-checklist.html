<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beijing Travel Checklist 2025 - Essential Guide for Visiting Beijing | China Travel Help</title>
  <meta name="description" content="Complete interactive Beijing travel checklist covering Forbidden City, Great Wall, Temple of Heaven, local cuisine, and essential travel tips for your Beijing adventure.">
  <meta name="keywords" content="Beijing travel checklist, Beijing travel guide, Forbidden City visit, Great Wall Beijing, Beijing attractions, Beijing travel tips, China travel Beijing, Beijing itinerary">
  <meta name="author" content="China Travel Help">
  <link rel="canonical" href="https://cn-travel-help.cn/Beijing-travel-checklist.html">
  
  <!-- Open Graph Meta Tags for Social Sharing -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Beijing Travel Checklist 2025 - Essential Guide for Visiting Beijing">
  <meta property="og:description" content="Complete interactive Beijing travel checklist covering Forbidden City, Great Wall, Temple of Heaven, and essential travel tips for your Beijing adventure.">
  <meta property="og:url" content="https://cn-travel-help.cn/Beijing-travel-checklist.html">
  <meta property="og:site_name" content="China Travel Help">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Beijing Travel Checklist 2025 - Essential Guide">
  <meta name="twitter:description" content="Complete interactive Beijing travel checklist covering Forbidden City, Great Wall, and essential travel tips.">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#0366d6">
  
  <!-- Structured Data for Beijing Travel Guide -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TravelGuide",
    "name": "Beijing Travel Checklist 2025 - Essential Guide for Visiting Beijing",
    "description": "Complete interactive Beijing travel checklist covering Forbidden City, Great Wall, Temple of Heaven, local cuisine, and essential travel tips for your Beijing adventure.",
    "url": "https://cn-travel-help.cn/Beijing-travel-checklist.html",
    "about": {
      "@type": "Place",
      "name": "Beijing",
      "alternateName": "Peking",
      "@id": "https://www.wikidata.org/wiki/Q956"
    },
    "publisher": {
      "@type": "Organization",
      "name": "China Travel Help",
      "url": "https://cn-travel-help.cn/"
    },
    "mainEntity": {
      "@type": "CheckList",
      "name": "Beijing Travel Checklist",
      "description": "Interactive checklist for visiting Beijing's major attractions and experiencing local culture."
    }
  }
  </script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1em;
      max-width: 700px;
      margin: auto;
      background: #fefefe;
    }
    h1 {
      text-align: center;
    }
    nav {
      margin-bottom: 2em;
    }
    nav a {
      display: inline-block;
      margin-right: 1em;
      text-decoration: none;
      color: #0366d6;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    details {
      margin-bottom: 1.5em;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 1em;
      background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    details:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }
    details[open] {
      background: linear-gradient(135deg, #fff 0%, #f0f8ff 100%);
      border-color: #0366d6;
    }
    summary {
      font-weight: bold;
      font-size: 1.3em;
      cursor: pointer;
      padding: 0.5em 0;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    summary:hover {
      color: #0366d6;
    }
    summary::before {
      content: 'ğŸ›ï¸';
      font-size: 1.2em;
    }
    details:nth-child(2) summary::before { content: 'ğŸ›ï¸'; } /* Forbidden City */
    details:nth-child(3) summary::before { content: 'â›©ï¸'; } /* Temple of Heaven */
    details:nth-child(4) summary::before { content: 'ğŸ°'; } /* Great Wall */
    details:nth-child(5) summary::before { content: 'ğŸ®'; } /* Hutongs */
    details:nth-child(6) summary::before { content: 'ğŸ¥Ÿ'; } /* Food */
    details:nth-child(7) summary::before { content: 'ğŸ¯'; } /* Bonus */
    label {
      display: flex;
      align-items: center;
      margin: 0.8em 0;
      cursor: pointer;
      padding: 0.5em 0.8em;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      font-size: 0.95em;
      line-height: 1.4;
    }
    label:hover {
      background-color: rgba(3, 102, 214, 0.05);
    }
    label input[type="checkbox"] {
      margin-right: 0.8em;
      transform: scale(1.1);
    }
    .attraction-icon {
      margin-right: 0.5em;
      font-size: 1.1em;
    }
    .social-sharing {
      background: white;
      padding: 1.5em;
      border-radius: 8px;
      text-align: center;
      margin: 2em 0;
      border: 1px solid #ddd;
    }
    .social-sharing h3 {
      color: #0366d6;
      margin-bottom: 0.5em;
      font-size: 1.1em;
    }
    .social-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
      justify-content: center;
      align-items: center;
    }
    .social-button {
      display: inline-flex;
      align-items: center;
      gap: 0.3em;
      padding: 0.5em 1em;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      border: none;
      font-size: 0.85em;
    }
    .social-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      text-decoration: none;
    }
    .social-button.facebook {
      background: #1877f2;
      color: white;
    }
    .social-button.twitter {
      background: #1da1f2;
      color: white;
    }
    .social-button.wechat {
      background: #07c160;
      color: white;
    }
    .social-button.copy {
      background: #6c757d;
      color: white;
    }
    .social-button.copy.copied {
      background: #28a745;
    }
    .related-destinations {
      background: #f8f9fa;
      padding: 1.5em;
      border-radius: 8px;
      margin: 2em 0;
      border: 1px solid #dee2e6;
    }
    .related-destinations h3 {
      color: #0366d6;
      margin-bottom: 1em;
      font-size: 1.1em;
      text-align: center;
    }
    .destination-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8em;
      justify-content: center;
    }
    .destination-links a {
      display: inline-block;
      padding: 0.7em 1.2em;
      background: #e3f2fd;
      color: #0366d6;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      transition: all 0.3s ease;
      border: 1px solid #bbdefb;
    }
    .destination-links a:hover {
      background: #2196f3;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      text-decoration: none;
    }
    @media (max-width: 600px) {
      .social-buttons {
        flex-direction: column;
        align-items: stretch;
      }
      .social-button {
        justify-content: center;
      }
      .destination-links {
        flex-direction: column;
        align-items: stretch;
      }
      .destination-links a {
        text-align: center;
      }
    }
    
    /* Page Rating Styles */
    .page-rating {
      background: white;
      padding: 1.5em;
      border-radius: 8px;
      text-align: center;
      margin: 2em 0;
      border: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .page-rating h3 {
      color: #0366d6;
      margin-bottom: 0.5em;
      font-size: 1.2em;
    }
    .page-rating p {
      margin-bottom: 1em;
      color: #666;
      font-size: 0.9em;
    }
    .rating-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8em;
    }
    .stars {
      display: flex;
      gap: 0.3em;
      justify-content: center;
    }
    .star {
      font-size: 1.8em;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0.2em;
      border-radius: 50%;
      filter: grayscale(100%) opacity(0.3);
    }
    .star:hover, .star:focus {
      transform: scale(1.1);
      outline: none;
      filter: grayscale(0%) opacity(1);
    }
    .star.active {
      filter: grayscale(0%) opacity(1);
    }
    .star.hover-active {
      filter: grayscale(0%) opacity(0.8);
    }
    .rating-info {
      font-size: 0.9em;
      color: #666;
      min-height: 1.2em;
    }
    .rating-info.rated {
      color: #0366d6;
      font-weight: 500;
    }
    @media (max-width: 600px) {
      .page-rating {
        margin: 1em 0;
        padding: 1em;
      }
      .star {
        font-size: 1.5em;
      }
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QEBJRV187V"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QEBJRV187V');
  </script>
  <!-- Hotjar Tracking Code -->
  <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:6507198,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
</head>
<body>
  <h1>Beijing Travel Checklist</h1>
  <nav>
    <a href="index.html">ğŸ  Home</a>
    <a href="Beijing-kids-checklist.html">ğŸ§’ Beijing for Kids</a>
    <a href="China-travel-checklist.html">ğŸ‡¨ğŸ‡³ China Guide</a>
  </nav>

  <details>
    <summary>1. The Forbidden City (æ•…å®«)</summary>
    <p>Explore the largest ancient imperial palace in the world. Imagine you're an emperor walking through the red walls and golden roofs.</p>
    <label><input type="checkbox" data-id="forbidden-1"> <span class="attraction-icon">ğŸšª</span>Enter through the Meridian Gate (åˆé—¨)</label>
    <label><input type="checkbox" data-id="forbidden-2"> <span class="attraction-icon">ğŸ²</span>Find a dragon decoration (hint: look up!)</label>
    <label><input type="checkbox" data-id="forbidden-3"> <span class="attraction-icon">ğŸ“¸</span>Take a photo in front of the Hall of Supreme Harmony</label>
    <label><input type="checkbox" data-id="forbidden-4"> <span class="attraction-icon">ğŸ“</span>Find the characters â€œæ•…å®«åšç‰©é™¢â€ and learn how to say them</label>
  </details>  <details>
    <summary>2. Temple of Heaven (å¤©å›)</summary>
    <p>Ancient emperors prayed here for good harvests. The architecture is full of cosmic symbols.</p>
    <label><input type="checkbox" data-id="temple-1"> <span class="attraction-icon">ğŸ‘</span>Clap your hands in the Echo Wall area</label>
    <label><input type="checkbox" data-id="temple-2"> <span class="attraction-icon">ğŸ›ï¸</span>Find the Hall of Prayer for Good Harvests</label>
    <label><input type="checkbox" data-id="temple-3"> <span class="attraction-icon">ğŸ§˜</span>Observe local people dancing or doing tai chi</label>
    <label><input type="checkbox" data-id="temple-4"> <span class="attraction-icon">ğŸ—£ï¸</span>Try saying â€œTiÄntÃ¡nâ€ in Chinese!</label>
  </details>  <details>
    <summary>3. Great Wall (é•¿åŸ)</summary>
    <p>One of the Seven Wonders of the World. Itâ€™s said that "You're not a true hero until you climb the Great Wall."</p>
    <label><input type="checkbox" data-id="wall-1"> <span class="attraction-icon">ğŸš¶</span>Climb at least 100 steps</label>
    <label><input type="checkbox" data-id="wall-2"> <span class="attraction-icon">ğŸ“·</span>Take a panorama photo from a watchtower</label>
    <label><input type="checkbox" data-id="wall-3"> <span class="attraction-icon">ğŸ‘€</span>Look for the phrase â€œä¸åˆ°é•¿åŸéå¥½æ±‰â€ and learn what it means</label>
    <label><input type="checkbox" data-id="wall-4"> <span class="attraction-icon">ğŸ™Œ</span>High five someone who made it to the top</label>
  </details>  <details>
    <summary>4. Hutongs (èƒ¡åŒ) and Local Life</summary>
    <p>These narrow alleys are full of Beijingâ€™s traditional life and hidden gems.</p>
    <label><input type="checkbox" data-id="hutong-1"> <span class="attraction-icon">ğŸ </span>Visit a local courtyard (å››åˆé™¢)</label>
    <label><input type="checkbox" data-id="hutong-2"> <span class="attraction-icon">ğŸ‘‹</span>Talk to a local or say â€œä½ å¥½ï¼â€</label>
    <label><input type="checkbox" data-id="hutong-3"> <span class="attraction-icon">ğŸ›º</span>Try a rickshaw ride</label>
    <label><input type="checkbox" data-id="hutong-4"> <span class="attraction-icon">ğŸ®</span>Find a door with red lanterns</label>
  </details>  <details>
    <summary>5. Food Adventure</summary>
    <p>Beijing food is full of history, flavor, and surprises!</p>
    <label><input type="checkbox" data-id="food-1"> <span class="attraction-icon">ğŸ¦†</span>Eat Peking Duck ğŸ¦†</label>
    <label><input type="checkbox" data-id="food-2"> <span class="attraction-icon">ğŸ¥</span>Try jianbing (ç…é¥¼) or baozi (åŒ…å­)</label>
    <label><input type="checkbox" data-id="food-3"> <span class="attraction-icon">ğŸ¥›</span>Drink hot soy milk or sour plum soup</label>
    <label><input type="checkbox" data-id="food-4"> <span class="attraction-icon">ğŸ¥¢</span>Learn to use chopsticks like a local</label>
  </details>  <details>
    <summary>ğŸ¯ Bonus: Cultural Bingo</summary>
    <p>Try to complete at least 3 of these!</p>
    <label><input type="checkbox" data-id="bonus-1"> <span class="attraction-icon">âœï¸</span>See someone doing calligraphy</label>
    <label><input type="checkbox" data-id="bonus-2"> <span class="attraction-icon">ğŸ‘‚</span>Hear a Beijing accent</label>
    <label><input type="checkbox" data-id="bonus-3"> <span class="attraction-icon">ğŸ­</span>Watch a street performance</label>
    <label><input type="checkbox" data-id="bonus-4"> <span class="attraction-icon">ğŸ¦</span>Spot a lion statue</label>
    <label><input type="checkbox" data-id="bonus-5"> <span class="attraction-icon">ğŸ’³</span>Use WeChat Pay</label>
    <label><input type="checkbox" data-id="bonus-6"> <span class="attraction-icon">ğŸ™</span>Learn how to say â€œthank youâ€ in Chinese</label>
  </details>

  <div class="social-sharing">
    <h3>ğŸ“± Share This Beijing Guide</h3>
    <p>Help others discover amazing Beijing attractions!</p>
    <div class="social-buttons">
      <button class="social-button facebook" onclick="shareOnFacebook()">
        ğŸ“˜ Facebook
      </button>
      <button class="social-button twitter" onclick="shareOnTwitter()">
        ğŸ¦ Twitter
      </button>
      <button class="social-button wechat" onclick="shareOnWeChat()">
        ğŸ’¬ WeChat
      </button>
      <button class="social-button copy" id="copyButton" onclick="copyLink()">
        ğŸ”— Copy Link
      </button>
    </div>
  </div>

  <div class="related-destinations">
    <h3>ğŸ—ºï¸ Explore More Imperial Cities</h3>
    <div class="destination-links">
      <a href="Xi-an-travel-checklist.html">ğŸº Xi'an - Terracotta Warriors</a>
      <a href="Shanghai-travel-checklist.html">ğŸ™ï¸ Shanghai - Modern Metropolis</a>
      <a href="Nanjing-travel-checklist.html">ğŸ›ï¸ Nanjing - Ancient Capital</a>
    </div>
  </div>

  <div class="page-rating">
    <h3>â­ Rate This Page</h3>
    <p>Help other travelers by rating this Beijing travel guide!</p>
    <div class="rating-container">
      <div class="stars" id="starRating">
        <span class="star" data-rating="1" tabindex="0" role="button" aria-label="Rate 1 star">â­</span>
        <span class="star" data-rating="2" tabindex="0" role="button" aria-label="Rate 2 stars">â­</span>
        <span class="star" data-rating="3" tabindex="0" role="button" aria-label="Rate 3 stars">â­</span>
        <span class="star" data-rating="4" tabindex="0" role="button" aria-label="Rate 4 stars">â­</span>
        <span class="star" data-rating="5" tabindex="0" role="button" aria-label="Rate 5 stars">â­</span>
      </div>
      <div class="rating-info" id="ratingInfo">
        <span>Click a star to rate this page</span>
      </div>
    </div>
  </div>

  <!-- Rating System Script -->
  <script>
    // Page Rating System - Works with or without Firebase
    (function() {
      'use strict';
      
      const pageId = 'beijing-travel-checklist';
      let stars, ratingInfo;
      let firebaseApp, db, auth, currentUser = null;
      let isFirebaseAvailable = false;
      
      // Initialize DOM elements
      function initializeDOM() {
        stars = document.querySelectorAll('.star');
        ratingInfo = document.getElementById('ratingInfo');
        
        if (!stars.length || !ratingInfo) {
          console.error('Rating elements not found');
          return false;
        }
        return true;
      }
      
      // Initialize Firebase (if available)
      async function initializeFirebase() {
        try {
          // Dynamic import to handle blocked resources gracefully
          const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js');
          const { getFirestore, doc, getDoc, setDoc, updateDoc, increment, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');
          const { getAuth, signInAnonymously, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js');
          
          // Firebase configuration
          const firebaseConfig = {
            apiKey: "AIzaSyBwmE3Bkgef0fLjXdbaiCKAi2jsSJ5LTRw",
            authDomain: "china-travel-help.firebaseapp.com",
            databaseURL: "https://china-travel-help-default-rtdb.firebaseio.com",
            projectId: "china-travel-help",
            storageBucket: "china-travel-help.firebasestorage.app",
            messagingSenderId: "82036149118",
            appId: "1:82036149118:web:f896a7fd914dad1786812f",
            measurementId: "G-LWY4T61FST"
          };

          // Initialize Firebase
          firebaseApp = initializeApp(firebaseConfig);
          db = getFirestore(firebaseApp);
          auth = getAuth(firebaseApp);
          
          // Store Firebase functions for later use
          window.firebaseFunctions = { doc, getDoc, setDoc, updateDoc, increment, serverTimestamp };
          
          isFirebaseAvailable = true;
          console.log('Firebase initialized successfully');
          
          // Initialize authentication
          onAuthStateChanged(auth, (user) => {
            if (user) {
              currentUser = user;
              loadRatingData();
            } else {
              signInAnonymously(auth);
            }
          });
          
        } catch (error) {
          console.log('Firebase not available, using localStorage fallback:', error.message);
          isFirebaseAvailable = false;
          loadLocalRatingData();
        }
      }
      
      // Load rating data from Firebase
      async function loadRatingData() {
        if (!isFirebaseAvailable) {
          loadLocalRatingData();
          return;
        }
        
        try {
          const { doc, getDoc } = window.firebaseFunctions;
          
          // Load aggregate rating data
          const aggregateDoc = await getDoc(doc(db, 'pageRatings', pageId));
          let aggregateData = { totalVotes: 0, totalScore: 0, averageRating: 0 };
          
          if (aggregateDoc.exists()) {
            aggregateData = aggregateDoc.data();
          }
          
          // Load user's personal rating
          let userRating = 0;
          if (currentUser) {
            const userDoc = await getDoc(doc(db, 'userRatings', `${currentUser.uid}_${pageId}`));
            if (userDoc.exists()) {
              userRating = userDoc.data().rating;
            }
          }
          
          // Update display
          updateRatingInfo(aggregateData, userRating);
          if (userRating > 0) {
            updateStarDisplay(userRating);
          }
          
        } catch (error) {
          console.error('Error loading Firebase rating data:', error);
          loadLocalRatingData();
        }
      }
      
      // Load rating data from localStorage (fallback)
      function loadLocalRatingData() {
        const data = localStorage.getItem(`pageRating_${pageId}`);
        const fallbackData = data ? JSON.parse(data) : { userRating: 0, totalVotes: 0, totalScore: 0 };
        updateRatingInfo({ totalVotes: fallbackData.totalVotes, totalScore: fallbackData.totalScore }, fallbackData.userRating);
        
        if (fallbackData.userRating > 0) {
          updateStarDisplay(fallbackData.userRating);
        }
      }

      // Save rating to Firebase
      async function saveRatingFirebase(newRating) {
        if (!isFirebaseAvailable || !currentUser) {
          return false;
        }
        
        try {
          const { doc, getDoc, setDoc, updateDoc, increment, serverTimestamp } = window.firebaseFunctions;
          
          const userRatingDocRef = doc(db, 'userRatings', `${currentUser.uid}_${pageId}`);
          const aggregateDocRef = doc(db, 'pageRatings', pageId);
          
          // Get current user rating
          const userDoc = await getDoc(userRatingDocRef);
          const previousRating = userDoc.exists() ? userDoc.data().rating : 0;
          
          // Save/update user rating
          await setDoc(userRatingDocRef, {
            userId: currentUser.uid,
            pageId: pageId,
            rating: newRating,
            timestamp: serverTimestamp()
          });
          
          // Update aggregate data
          const aggregateDoc = await getDoc(aggregateDocRef);
          
          if (previousRating === 0) {
            // New rating
            if (aggregateDoc.exists()) {
              await updateDoc(aggregateDocRef, {
                totalVotes: increment(1),
                totalScore: increment(newRating),
                lastUpdated: serverTimestamp()
              });
            } else {
              await setDoc(aggregateDocRef, {
                totalVotes: 1,
                totalScore: newRating,
                averageRating: newRating,
                lastUpdated: serverTimestamp()
              });
            }
          } else {
            // Update existing rating
            const scoreDifference = newRating - previousRating;
            await updateDoc(aggregateDocRef, {
              totalScore: increment(scoreDifference),
              lastUpdated: serverTimestamp()
            });
          }
          
          // Calculate new average
          const updatedDoc = await getDoc(aggregateDocRef);
          if (updatedDoc.exists()) {
            const data = updatedDoc.data();
            const newAverage = data.totalScore / data.totalVotes;
            await updateDoc(aggregateDocRef, {
              averageRating: newAverage
            });
          }
          
          return true;
          
        } catch (error) {
          console.error('Error saving to Firebase:', error);
          return false;
        }
      }
      
      // Save rating to localStorage (fallback)
      function saveRatingLocal(newRating) {
        const data = JSON.parse(localStorage.getItem(`pageRating_${pageId}`) || '{"userRating":0,"totalVotes":0,"totalScore":0}');
        const wasRated = data.userRating > 0;
        
        if (wasRated) {
          data.totalScore = data.totalScore - data.userRating + newRating;
          data.userRating = newRating;
        } else {
          data.totalVotes += 1;
          data.totalScore += newRating;
          data.userRating = newRating;
        }
        
        localStorage.setItem(`pageRating_${pageId}`, JSON.stringify(data));
        updateStarDisplay(newRating);
        updateRatingInfo({ totalVotes: data.totalVotes, totalScore: data.totalScore }, data.userRating);
        
        return true;
      }
      
      // Save rating (tries Firebase first, falls back to localStorage)
      async function saveRating(newRating) {
        const firebaseSuccess = await saveRatingFirebase(newRating);
        
        if (firebaseSuccess) {
          await loadRatingData(); // Reload to get updated aggregate data
          const wasUpdate = await checkIfUpdate(newRating);
          const message = wasUpdate ? 'Rating updated!' : 'Thank you for rating!';
          showRatingMessage(message);
          return true;
        } else {
          const localSuccess = saveRatingLocal(newRating);
          if (localSuccess) {
            const data = JSON.parse(localStorage.getItem(`pageRating_${pageId}`));
            const wasUpdate = data.totalVotes > 1; // Rough approximation
            const message = wasUpdate ? 'Rating saved locally!' : 'Rating saved locally!';
            showRatingMessage(message);
            return true;
          }
        }
        
        return false;
      }
      
      // Check if this is an update to existing rating
      async function checkIfUpdate(newRating) {
        if (isFirebaseAvailable && currentUser) {
          try {
            const { doc, getDoc } = window.firebaseFunctions;
            const userDoc = await getDoc(doc(db, 'userRatings', `${currentUser.uid}_${pageId}`));
            return userDoc.exists();
          } catch (error) {
            return false;
          }
        } else {
          const data = JSON.parse(localStorage.getItem(`pageRating_${pageId}`) || '{"userRating":0}');
          return data.userRating > 0;
        }
      }

      // Show rating message
      function showRatingMessage(message) {
        ratingInfo.innerHTML = message;
        setTimeout(() => {
          if (isFirebaseAvailable) {
            loadRatingData();
          } else {
            loadLocalRatingData();
          }
        }, 2000);
      }
      
      // Update star display
      function updateStarDisplay(rating) {
        stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });
      }
      
      // Update rating info display
      function updateRatingInfo(aggregateData, userRating = 0) {
        if (aggregateData.totalVotes > 0) {
          const average = aggregateData.averageRating || (aggregateData.totalScore / aggregateData.totalVotes);
          const voteText = aggregateData.totalVotes === 1 ? 'vote' : 'votes';
          ratingInfo.innerHTML = `Average: ${average.toFixed(1)}/5 (${aggregateData.totalVotes} ${voteText})`;
          ratingInfo.classList.add('rated');
          if (userRating > 0) {
            updateStarDisplay(userRating);
          }
        } else {
          ratingInfo.innerHTML = 'Click a star to rate this page';
          ratingInfo.classList.remove('rated');
        }
      }
      
      // Handle star click
      async function handleStarClick(rating) {
        ratingInfo.innerHTML = 'Saving your rating...';
        updateStarDisplay(rating);
        
        const success = await saveRating(rating);
        if (!success) {
          ratingInfo.innerHTML = 'Error saving rating. Please try again.';
        }
      }
      
      // Initialize rating system
      function initializeRatingSystem() {
        if (!initializeDOM()) return;
        
        stars.forEach((star, index) => {
          const rating = index + 1;
          
          // Click handler
          star.addEventListener('click', () => handleStarClick(rating));
          
          // Keyboard handler
          star.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              handleStarClick(rating);
            }
          });
          
          // Hover effects
          star.addEventListener('mouseenter', () => {
            stars.forEach((s, i) => {
              if (i < rating) {
                s.classList.add('hover-active');
              } else {
                s.classList.remove('hover-active');
              }
            });
          });
          
          star.addEventListener('mouseleave', () => {
            stars.forEach(s => s.classList.remove('hover-active'));
          });
        });
        
        // Initialize Firebase (async)
        initializeFirebase();
        
        // Show initial loading state
        ratingInfo.innerHTML = 'Loading ratings...';
      }
      
      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeRatingSystem);
      } else {
        initializeRatingSystem();
      }
      
    })();

    // Checkbox persistence (keep using localStorage)
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        const id = cb.dataset.id;
        cb.checked = localStorage.getItem(id) === 'true';
        cb.addEventListener('change', () => {
          localStorage.setItem(id, cb.checked);
        });
      });
    });
  </script>

  <script>
    function shareOnFacebook() {
      const url = encodeURIComponent(window.location.href);
      window.open(
        `https://www.facebook.com/sharer/sharer.php?u=${url}`,
        'facebook-share-dialog',
        'width=626,height=436'
      );
    }

    function shareOnTwitter() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent('Check out this amazing Beijing travel checklist! ğŸ›ï¸ğŸ‡¨ğŸ‡³');
      window.open(
        `https://twitter.com/intent/tweet?url=${url}&amp;text=${text}`,
        'twitter-share-dialog',
        'width=550,height=235'
      );
    }

    function shareOnWeChat() {
      copyLink();
      alert('ğŸ“± Link copied! Open WeChat and paste the link to share with friends.');
    }

    function copyLink() {
      const copyButton = document.getElementById('copyButton');
      navigator.clipboard.writeText(window.location.href).then(function() {
        copyButton.textContent = 'âœ… Copied!';
        copyButton.classList.add('copied');
        setTimeout(function() {
          copyButton.textContent = 'ğŸ”— Copy Link';
          copyButton.classList.remove('copied');
        }, 2000);
      }, function(err) {
        const textArea = document.createElement('textarea');
        textArea.value = window.location.href;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        copyButton.textContent = 'âœ… Copied!';
        copyButton.classList.add('copied');
        setTimeout(function() {
          copyButton.textContent = 'ğŸ”— Copy Link';
          copyButton.classList.remove('copied');
        }, 2000);
      });
    }
  </script>
</body>
</html>
